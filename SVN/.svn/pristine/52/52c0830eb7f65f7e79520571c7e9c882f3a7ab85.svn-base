#include "fir_filter.h"

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
  0.005215378658538277,
  0.0009388420660635967,
  0.0009774314915853518,
  0.000984261620189437,
  0.0009480259237025155,
  0.0008839390693253766,
  0.0007619117375020001,
  0.0005957728072180525,
  0.0003866957662889191,
  0.00012745621544244827,
  -0.00017745289002627025,
  -0.0005303976631465747,
  -0.0009257161240469592,
  -0.0013544233401720516,
  -0.0018120756509966193,
  -0.0022893956184860203,
  -0.0027781397311382725,
  -0.0032681615005502236,
  -0.003745397290601612,
  -0.0041976621842907584,
  -0.004610646268783657,
  -0.004969480440795117,
  -0.005259640309123443,
  -0.005464669824303994,
  -0.005569880657668855,
  -0.005561266001110383,
  -0.005425166547907249,
  -0.0051498673161057915,
  -0.004723890978111263,
  -0.004137850329220603,
  -0.0033848245449805306,
  -0.0024594993212692404,
  -0.0013596092739225664,
  -0.00008508242843851094,
  0.0013613807613592612,
  0.002973539166466187,
  0.004742664146151116,
  0.006656907227030775,
  0.008701766476198988,
  0.010860401014414687,
  0.013113041774555165,
  0.015437907526375671,
  0.017811252591715784,
  0.020207633067996344,
  0.02260063545164497,
  0.024962710629363127,
  0.02726591865675948,
  0.029482451121272322,
  0.031584897509324215,
  0.033546998419857116,
  0.03534377107878015,
  0.03695197003609854,
  0.03835062847077768,
  0.03952128093300167,
  0.0404484461223121,
  0.04111977862592068,
  0.041526245336763856,
  0.04166235626659378,
  0.041526245336763856,
  0.04111977862592068,
  0.0404484461223121,
  0.03952128093300167,
  0.03835062847077768,
  0.03695197003609854,
  0.03534377107878015,
  0.033546998419857116,
  0.031584897509324215,
  0.029482451121272322,
  0.02726591865675948,
  0.024962710629363127,
  0.02260063545164497,
  0.020207633067996344,
  0.017811252591715784,
  0.015437907526375671,
  0.013113041774555165,
  0.010860401014414687,
  0.008701766476198988,
  0.006656907227030775,
  0.004742664146151116,
  0.002973539166466187,
  0.0013613807613592612,
  -0.00008508242843851094,
  -0.0013596092739225664,
  -0.0024594993212692404,
  -0.0033848245449805306,
  -0.004137850329220603,
  -0.004723890978111263,
  -0.0051498673161057915,
  -0.005425166547907249,
  -0.005561266001110383,
  -0.005569880657668855,
  -0.005464669824303994,
  -0.005259640309123443,
  -0.004969480440795117,
  -0.004610646268783657,
  -0.0041976621842907584,
  -0.003745397290601612,
  -0.0032681615005502236,
  -0.0027781397311382725,
  -0.0022893956184860203,
  -0.0018120756509966193,
  -0.0013544233401720516,
  -0.0009257161240469592,
  -0.0005303976631465747,
  -0.00017745289002627025,
  0.00012745621544244827,
  0.0003866957662889191,
  0.0005957728072180525,
  0.0007619117375020001,
  0.0008839390693253766,
  0.0009480259237025155,
  0.000984261620189437,
  0.0009774314915853518,
  0.0009388420660635967,
  0.005215378658538277
};

void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

double SampleFilter_get(SampleFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}