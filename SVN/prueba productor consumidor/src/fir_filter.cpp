#include "fir_filter.h"

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
  0.004348638513769103,
  -0.00100291676943246,
  -0.0009646485146986414,
  -0.0009644532328677376,
  -0.0009781350972685205,
  -0.0009919369433068473,
  -0.0009829939011800294,
  -0.0009390884104989949,
  -0.0008479655098891142,
  -0.0007057398432590076,
  -0.0005121016880625853,
  -0.00027464955381566994,
  -0.000005377919583072621,
  0.0002775903378510516,
  0.0005534942963238949,
  0.0007989564317949251,
  0.0009915651372308328,
  0.0011107812007866793,
  0.0011411670064039967,
  0.0010732483453785935,
  0.000905746838482595,
  0.0006455798825180202,
  0.00030857593132650485,
  -0.00008186575626287924,
  -0.0004957182228553771,
  -0.0008989805448886305,
  -0.0012559146898296054,
  -0.0015324556919785524,
  -0.0016989201995694662,
  -0.0017332341263699086,
  -0.0016230550169643082,
  -0.0013677910483755348,
  -0.0009791787375171617,
  -0.00048133780154508614,
  0.00009071122851393833,
  0.0006931368246770772,
  0.0012766795320599176,
  0.0017903535937345218,
  0.0021858717370310107,
  0.0024218077549042903,
  0.0024677206522715654,
  0.002307332837858558,
  0.0019409381184121866,
  0.0013863209064192026,
  0.0006784434417922662,
  -0.00013253655051714003,
  -0.000984495033124777,
  -0.0018079395093972266,
  -0.002531376753723142,
  -0.0030873009060210367,
  -0.003418100529037922,
  -0.003481583201678631,
  -0.003255452373706638,
  -0.0027404468715056174,
  -0.0019616757861028937,
  -0.0009680293729742473,
  0.00017047210336260118,
  0.0013672407774119907,
  0.0025253516234577675,
  0.003545017524286967,
  0.004331737650022833,
  0.004804528556958762,
  0.004903490145295213,
  0.004596137560519773,
  0.003881783938738386,
  0.002793644967513164,
  0.0013981861899520578,
  -0.0002081969669025004,
  -0.0019052801824277722,
  -0.0035573047146632104,
  -0.0050232086206327764,
  -0.00616776550434178,
  -0.006873137303243772,
  -0.007049553416415177,
  -0.006644630220789654,
  -0.005650046275331457,
  -0.004105384138376747,
  -0.002098118093385859,
  0.00023989458446328847,
  0.0027400008073337465,
  0.0052073807074509955,
  0.0074348398604731575,
  0.009218080698243734,
  0.010372269942453296,
  0.01074776326575631,
  0.010244807465497049,
  0.008824925434693638,
  0.006519194978241247,
  0.003431281660921578,
  -0.0002638041252873227,
  -0.004326996703984344,
  -0.00846652637745375,
  -0.012354709853910373,
  -0.01564709524949305,
  -0.01800516269972707,
  -0.01911847897221492,
  -0.01872778819623757,
  -0.01664409545877054,
  -0.01276616116540681,
  -0.007090743226075551,
  0.0002802560921430138,
  0.009142268580933331,
  0.019193296427067515,
  0.030050039772879282,
  0.04126395409621174,
  0.052348909709579824,
  0.06280268786668097,
  0.0721424285099315,
  0.07992177094791221,
  0.08577478730899155,
  0.08939383800518118,
  0.09062524144308189,
  0.08939383800518118,
  0.08577478730899155,
  0.07992177094791221,
  0.0721424285099315,
  0.06280268786668097,
  0.052348909709579824,
  0.04126395409621174,
  0.030050039772879282,
  0.019193296427067515,
  0.009142268580933331,
  0.0002802560921430138,
  -0.007090743226075551,
  -0.01276616116540681,
  -0.01664409545877054,
  -0.01872778819623757,
  -0.01911847897221492,
  -0.01800516269972707,
  -0.01564709524949305,
  -0.012354709853910373,
  -0.00846652637745375,
  -0.004326996703984344,
  -0.0002638041252873227,
  0.003431281660921578,
  0.006519194978241247,
  0.008824925434693638,
  0.010244807465497049,
  0.01074776326575631,
  0.010372269942453296,
  0.009218080698243734,
  0.0074348398604731575,
  0.0052073807074509955,
  0.0027400008073337465,
  0.00023989458446328847,
  -0.002098118093385859,
  -0.004105384138376747,
  -0.005650046275331457,
  -0.006644630220789654,
  -0.007049553416415177,
  -0.006873137303243772,
  -0.00616776550434178,
  -0.0050232086206327764,
  -0.0035573047146632104,
  -0.0019052801824277722,
  -0.0002081969669025004,
  0.0013981861899520578,
  0.002793644967513164,
  0.003881783938738386,
  0.004596137560519773,
  0.004903490145295213,
  0.004804528556958762,
  0.004331737650022833,
  0.003545017524286967,
  0.0025253516234577675,
  0.0013672407774119907,
  0.00017047210336260118,
  -0.0009680293729742473,
  -0.0019616757861028937,
  -0.0027404468715056174,
  -0.003255452373706638,
  -0.003481583201678631,
  -0.003418100529037922,
  -0.0030873009060210367,
  -0.002531376753723142,
  -0.0018079395093972266,
  -0.000984495033124777,
  -0.00013253655051714003,
  0.0006784434417922662,
  0.0013863209064192026,
  0.0019409381184121866,
  0.002307332837858558,
  0.0024677206522715654,
  0.0024218077549042903,
  0.0021858717370310107,
  0.0017903535937345218,
  0.0012766795320599176,
  0.0006931368246770772,
  0.00009071122851393833,
  -0.00048133780154508614,
  -0.0009791787375171617,
  -0.0013677910483755348,
  -0.0016230550169643082,
  -0.0017332341263699086,
  -0.0016989201995694662,
  -0.0015324556919785524,
  -0.0012559146898296054,
  -0.0008989805448886305,
  -0.0004957182228553771,
  -0.00008186575626287924,
  0.00030857593132650485,
  0.0006455798825180202,
  0.000905746838482595,
  0.0010732483453785935,
  0.0011411670064039967,
  0.0011107812007866793,
  0.0009915651372308328,
  0.0007989564317949251,
  0.0005534942963238949,
  0.0002775903378510516,
  -0.000005377919583072621,
  -0.00027464955381566994,
  -0.0005121016880625853,
  -0.0007057398432590076,
  -0.0008479655098891142,
  -0.0009390884104989949,
  -0.0009829939011800294,
  -0.0009919369433068473,
  -0.0009781350972685205,
  -0.0009644532328677376,
  -0.0009646485146986414,
  -0.00100291676943246,
  0.004348638513769103
};

void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

double SampleFilter_get(SampleFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}